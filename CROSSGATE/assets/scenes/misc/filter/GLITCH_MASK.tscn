[gd_scene load_steps=4 format=2]

[ext_resource path="res://assets/sprites/misc/ShaderFX/glitch.jpg" type="Texture" id=1]

[sub_resource type="Shader" id=9]
code = "shader_type canvas_item;
render_mode unshaded;

uniform bool grayscale = false;
uniform sampler2D displace : hint_albedo;
uniform float displaceAmount : hint_range(0, 0.1);
uniform float abberationAmount : hint_range(0, 0.1);
uniform float displaceSize : hint_range(0, 1);
uniform float displaceFrequency : hint_range(0, 100);

void fragment() {
	vec4 disp = texture(displace, SCREEN_UV * abs(cos(TIME * displaceFrequency))*displaceSize);
	vec2 newUV = SCREEN_UV + disp.xy * abs(sin(TIME))*displaceAmount;
	COLOR.r = texture(SCREEN_TEXTURE, newUV - cos(TIME)*abberationAmount).r;
	COLOR.g = texture(SCREEN_TEXTURE, newUV).g;
	COLOR.b = texture(SCREEN_TEXTURE, newUV - sin(TIME)*abberationAmount).b;
	COLOR.a = texture(SCREEN_TEXTURE, newUV).a;
	if(grayscale){
		COLOR.rgb = vec3(dot(COLOR.rgb, vec3(0.299, 0.587, 0.114)));
	}
}"

[sub_resource type="ShaderMaterial" id=10]
shader = SubResource( 9 )
shader_param/grayscale = false
shader_param/displaceAmount = 0.008
shader_param/abberationAmount = 0.003
shader_param/displaceSize = 1.0
shader_param/displaceFrequency = 5.0
shader_param/displace = ExtResource( 1 )

[node name="GLITCH_MASK" type="ColorRect"]
visible = false
material = SubResource( 10 )
margin_right = 1280.0
margin_bottom = 720.0
